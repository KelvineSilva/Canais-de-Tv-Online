<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Canais de Tv Online</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #f0f0f0;
      margin: 0;
      padding: 20px;
    }

    .container {
      max-width: 800px;
      margin: 20px auto;
      background-color: #fff;
      border-radius: 8px;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
      padding: 20px;
    }

    h1 {
      color: #333;
      text-align: center;
    }

    .categoria {
      margin-bottom: 20px;
      border-bottom: 1px solid #ccc;
      padding-bottom: 20px;
    }

    .categoria h2 {
      color: #1877f2;
      font-size: 24px;
      margin-bottom: 10px;
    }

    .canal-card {
      background-color: #f9f9f9;
      padding: 10px;
      margin-top: 10px;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }

    .canal-card img {
      width: 100%;
      height: 150px;
      object-fit: cover;
      border-top-left-radius: 8px;
      border-top-right-radius: 8px;
    }

    .canal-card .card-info {
      padding: 10px;
    }

    .canal-card h3 {
      margin: 10px 0;
      font-size: 18px;
      color: #333;
    }

    .canal-card p {
      font-size: 14px;
      color: #666;
      margin-bottom: 10px;
    }

    .canal-card a {
      display: inline-block;
      padding: 8px 16px;
      background-color: #1877f2;
      color: #fff;
      text-decoration: none;
      border-radius: 4px;
      transition: background-color 0.3s ease;
      margin-right: 10px;
    }

    .canal-card a:hover {
      background-color: #0e5a8a;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Categorias e Canais Disponíveis</h1>

    <div id="categorias-lista">
      <!-- As categorias e canais serão adicionados dinamicamente aqui -->
    </div>
  </div>

  <!-- Importação do Firebase SDK e código JavaScript -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.3/firebase-app.js";
    import { getFirestore, collection, getDocs, query, where, onSnapshot } from "https://www.gstatic.com/firebasejs/10.12.3/firebase-firestore.js";

    // Configuração do Firebase
    const firebaseConfig = {
      apiKey: "AIzaSyDZnfBt-ulNBLPHo4P124GEzYuV18AJZjU",
      authDomain: "rede-canais-online.firebaseapp.com",
      projectId: "rede-canais-online",
      storageBucket: "rede-canais-online.appspot.com",
      messagingSenderId: "712941850158",
      appId: "1:712941850158:web:6e410f466af8774a1a99bf",
      measurementId: "G-BZQEXCNEYL"
    };

    // Inicializar o Firebase
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    // Referência às coleções de categorias e canais
    const categoriasCollection = collection(db, 'categorias');
    const canaisCollection = collection(db, 'canais');

    // Função para carregar categorias e canais associados
    async function carregarCategorias() {
      const categoriasLista = document.getElementById('categorias-lista');
      categoriasLista.innerHTML = ''; // Limpar a lista antes de atualizar

      try {
        const categoriasQuerySnapshot = await getDocs(categoriasCollection);
        categoriasQuerySnapshot.forEach(async (categoriaDoc) => {
          const categoriaData = categoriaDoc.data();
          const categoriaId = categoriaDoc.id;

          // Criar elemento HTML para a categoria
          const categoriaElement = document.createElement('div');
          categoriaElement.classList.add('categoria');
          categoriaElement.innerHTML = `
            <h2>${categoriaData.nome}</h2>
            <div id="canais-${categoriaId}" class="canais-lista">
              <!-- Os canais serão adicionados dinamicamente aqui -->
            </div>
          `;
          categoriasLista.appendChild(categoriaElement);

          // Carregar canais associados à categoria
          const canaisQuerySnapshot = await getDocs(query(canaisCollection, where('categoriaId', '==', categoriaId)));
          const canaisLista = document.getElementById(`canais-${categoriaId}`);
          canaisQuerySnapshot.forEach((canalDoc) => {
            const canalData = canalDoc.data();
            const canalCard = document.createElement('div');
            canalCard.classList.add('canal-card');
            canalCard.innerHTML = `
              <img src="${canalData.imagem}" alt="${canalData.nome}">
              <div class="card-info">
                <h3>${canalData.nome}</h3>
                <p>
                  <a href="${canalData.link}" target="_blank">Ver Canal</a>
                </p>
              </div>
            `;
            canaisLista.appendChild(canalCard);
          });
        });
      } catch (error) {
        console.error('Erro ao carregar categorias e canais: ', error);
        // Opcional: exibir mensagem de erro
        alert('Erro ao carregar categorias e canais. Verifique o console para mais detalhes.');
      }
    }

    // Chamar a função para carregar categorias ao carregar a página
    carregarCategorias();

    // Atualizar a lista de categorias e canais quando houver alterações no Firestore
    onSnapshot(categoriasCollection, () => {
      carregarCategorias();
    });
  </script>
</body>
</html>
